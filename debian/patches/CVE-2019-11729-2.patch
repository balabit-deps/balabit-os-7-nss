
# HG changeset patch
# User Kevin Jacobs <kjacobs@mozilla.com>
# Date 1561145635 0
# Node ID ebc93d6daeaa9001d31fd18b5199779da99ae9aa
# Parent  efd44c8a6c6330fd5752f57d8d8b627aa3b36b43
Bug 1515342 - Ignore spki decode failures on negative (expect_fail) tests. r=jcj

Differential Revision: https://phabricator.services.mozilla.com/D35565

Index: nss-3.35/nss/gtests/pk11_gtest/pk11_curve25519_unittest.cc
===================================================================
--- nss-3.35.orig/nss/gtests/pk11_gtest/pk11_curve25519_unittest.cc	2019-07-12 08:16:22.108615488 -0400
+++ nss-3.35/nss/gtests/pk11_gtest/pk11_curve25519_unittest.cc	2019-07-12 08:16:22.108615488 -0400
@@ -76,6 +76,9 @@ class Pkcs11Curve25519Test : public ::te
 
     ScopedCERTSubjectPublicKeyInfo certSpki(
         SECKEY_DecodeDERSubjectPublicKeyInfo(&spkiItem));
+    if (!expect_success && !certSpki) {
+      return;
+    }
     ASSERT_TRUE(certSpki);
 
     ScopedSECKEYPublicKey pubKey(SECKEY_ExtractPublicKey(certSpki.get()));
